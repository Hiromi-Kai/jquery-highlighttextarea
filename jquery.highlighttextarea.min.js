/*!
 * jQuery highlightTextarea 3.1.1
 * Copyright 2014-2015 Damien "Mistic" Sorel (http://www.strangeplanet.fr)
 * Licensed under MIT (http://opensource.org/licenses/MIT)
 */
(function(t){"use strict";var i=function(s,r){this.settings=t.extend({},i.DEFAULTS);this.scrollbarWidth=e.getScrollbarWidth();this.isInput=s[0].tagName.toLowerCase()=="input";this.active=false;this.$el=s;this.$el.wrap('<div class="highlightTextarea"></div>');this.$main=this.$el.parent();this.$main.prepend('<div class="highlightTextarea-container"><div class="highlightTextarea-highlighter"></div></div>');this.$container=this.$main.children().first();this.$highlighter=this.$container.children();this.setOptions(r);if(this.settings.id){this.$main[0].id=this.settings.id}if(this.settings.resizable){this.applyResizable()}this.updateCss();this.bindEvents();this.highlight()};i.DEFAULTS={words:{},ranges:{},color:"#ffff00",caseSensitive:true,wordsOnly:false,resizable:false,id:"",debug:false};i.prototype.highlight=function(){var i=e.htmlEntities(this.$el.val()),s=this;s.spacer="";if(this.settings.wordsOnly){s.spacer="(^|\\s|$)"}t.each(this.settings.words,function(t,e){var r=new RegExp(s.spacer+"("+e.join("|")+")"+s.spacer,s.regParam);var n='$1<mark style="background-color:'+t+';">$2</mark>$3';i=i.replace(r,n).replace(r,n)});t.each(this.settings.ranges,function(t,s){if(s.start<i.length){i=e.strInsert(i,s.end,"</mark>");var r='<mark style="background-color:'+s.color+';"';if(s.class!=null){r+='class="'+s.class+'"'}r+=">";i=e.strInsert(i,s.start,r)}});this.$highlighter.html(i);this.updateSizePosition()};i.prototype.setWords=function(t){this.setOptions({words:t,ranges:{}})};i.prototype.setRanges=function(t){this.setOptions({words:{},ranges:t})};i.prototype.enable=function(){this.bindEvents();this.highlight()};i.prototype.disable=function(){this.unbindEvents();this.$highlighter.empty()};i.prototype.destroy=function(){this.disable();e.cloneCss(this.$container,this.$el,["background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size","background-attachment"]);this.$main.replaceWith(this.$el);this.$el.removeData("highlighter")};i.prototype.setOptions=function(i){if(typeof i!="object"||t.isEmptyObject(i)){return}t.extend(this.settings,i);this.regParam=this.settings.caseSensitive?"gm":"gim";if(!t.isEmptyObject(this.settings.words)){this.settings.words=e.cleanWords(this.settings.words,this.settings.color);this.settings.ranges={}}else if(!t.isEmptyObject(this.settings.ranges)){this.settings.words={};this.settings.ranges=e.cleanRanges(this.settings.ranges,this.settings.color)}if(this.settings.debug){this.$main.addClass("debug")}else{this.$main.removeClass("debug")}if(this.active){this.highlight()}};i.prototype.bindEvents=function(){if(this.active){return}this.active=true;var i=this;this.$highlighter.on({"this.highlighter":function(){i.$el.focus()}});this.$el.on({"input.highlightTextarea":e.throttle(function(){this.highlight()},100,this),"resize.highlightTextarea":e.throttle(function(){this.updateSizePosition(true)},50,this),"scroll.highlightTextarea select.highlightTextarea":e.throttle(function(){this.updateSizePosition()},50,this)});if(this.isInput){this.$el.on({"keydown.highlightTextarea keypress.highlightTextarea keyup.highlightTextarea":function(){setTimeout(t.proxy(i.updateSizePosition,i),1)},"blur.highlightTextarea":function(){this.value=this.value;this.scrollLeft=0;i.updateSizePosition.call(i)}})}};i.prototype.unbindEvents=function(){if(!this.active){return}this.active=false;this.$highlighter.off(".highlightTextarea");this.$el.off(".highlightTextarea")};i.prototype.updateCss=function(){e.cloneCss(this.$el,this.$main,["float","vertical-align"]);this.$main.css({width:this.$el.outerWidth(true),height:this.$el.outerHeight(true)});e.cloneCss(this.$el,this.$container,["background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size","background-attachment","padding-top","padding-right","padding-bottom","padding-left"]);this.$container.css({top:e.toPx(this.$el.css("margin-top"))+e.toPx(this.$el.css("border-top-width")),left:e.toPx(this.$el.css("margin-left"))+e.toPx(this.$el.css("border-left-width")),width:this.$el.width(),height:this.$el.height()});e.cloneCss(this.$el,this.$highlighter,["font-size","font-family","font-style","font-weight","font-variant","font-stretch","line-height","vertical-align","word-spacing","text-align","letter-spacing","text-rendering"]);this.$el.css({background:"none"})};i.prototype.applyResizable=function(){if(jQuery.ui){this.$el.resizable({handles:"se",resize:e.throttle(function(){this.updateSizePosition(true)},50,this)})}};i.prototype.updateSizePosition=function(t){if(t){this.$main.css({width:this.$el.outerWidth(true),height:this.$el.outerHeight(true)});this.$container.css({width:this.$el.width(),height:this.$el.height()})}var i=0,e;if(!this.isInput){if(this.$el.css("overflow")=="scroll"||this.$el.css("overflow-y")=="scroll"||this.$el.css("overflow")!="hidden"&&this.$el.css("overflow-y")!="hidden"&&this.$el[0].clientHeight<this.$el[0].scrollHeight){i=this.scrollbarWidth}e=this.$el.width()-i}else{e=99999}this.$highlighter.css({width:e,height:this.$el.height()+this.$el.scrollTop(),top:-this.$el.scrollTop(),left:-this.$el.scrollLeft()})};var e=function(){};e.getScrollbarWidth=function(){var i=t('<div style="width:50px;height:50px;overflow:auto"><div>&nbsp;</div></div>').appendTo("body"),e=i.children(),s=e.innerWidth()-e.height(100).innerWidth();i.remove();return s};e.cloneCss=function(t,i,e){for(var s=0,r=e.length;s<r;s++){i.css(e[s],t.css(e[s]))}};e.toPx=function(i){if(i!=i.replace("em","")){var e=t('<div style="font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;">&nbsp;</div>').appendTo("body");i=Math.round(parseFloat(i.replace("em",""))*e.height());e.remove();return i}else if(i!=i.replace("px","")){return parseInt(i.replace("px",""))}else{return parseInt(i)}};e.htmlEntities=function(i){if(i){return t("<div></div>").text(i).html()}else{return""}};e.strInsert=function(t,i,e){return t.slice(0,i)+e+t.slice(i)};e.throttle=function(t,i,e){var s={pid:null,last:0};return function(){var r=(new Date).getTime()-s.last,n=arguments,h=this;function a(){s.last=(new Date).getTime();if(e){return t.apply(e,Array.prototype.slice.call(n))}else{return t.apply(h,Array.prototype.slice.call(n))}}if(r>i){return a()}else{clearTimeout(s.pid);s.pid=setTimeout(a,i-r)}}};e.cleanWords=function(i,s){var r={};if(!t.isArray(i)){i=[i]}for(var n=0,h=i.length;n<h;n++){var a=i[n];if(t.isPlainObject(a)){if(!r[a.color]){r[a.color]=[]}if(!t.isArray(a.words)){a.words=[a.words]}for(var o=0,l=a.words.length;o<l;o++){r[a.color].push(e.htmlEntities(a.words[o]))}}else{if(!r[s]){r[s]=[]}r[s].push(e.htmlEntities(a))}}return r};e.cleanRanges=function(i,e){var s=[];if(t.isPlainObject(i)||t.isNumeric(i[0])){i=[i]}for(var r=0,n=i.length;r<n;r++){var h=i[r];if(t.isArray(h)){s.push({color:e,start:h[0],end:h[1]})}else{if(h.ranges){if(t.isPlainObject(h.ranges)||t.isNumeric(h.ranges[0])){h.ranges=[h.ranges]}for(var a=0,o=h.ranges.length;a<o;a++){if(t.isArray(h.ranges[a])){s.push({color:h.color,class:h.class,start:h.ranges[a][0],end:h.ranges[a][1]})}else{if(h.ranges[a].length){h.ranges[a].end=h.ranges[a].start+h.ranges[a].length}s.push(h.ranges[a])}}}else{if(h.length){h.end=h.start+h.length}s.push(h)}}}s.sort(function(t,i){if(t.start==i.start){return t.end-i.end}return t.start-i.start});var l=-1;t.each(s,function(i,e){if(e.start>=e.end){t.error("Invalid range end/start")}if(e.start<l){t.error("Ranges overlap")}l=e.end});s.reverse();return s};t.fn.highlightTextarea=function(e){var s=arguments;return this.each(function(){var r=t(this),n=r.data("highlighter"),h=typeof e=="object"&&e;if(!n&&e=="destroy"){return}if(!n){n=new i(r,h);r.data("highlighter",n)}if(typeof e=="string"){n[e].apply(n,Array.prototype.slice.call(s,1))}})}})(window.jQuery||window.Zepto);